<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ€ç»´å¯¼å›¾æ’ä»¶è°ƒè¯•é¡µé¢</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .debug-section {
            margin: 20px 0;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 5px;
        }
        .debug-section h3 {
            margin-top: 0;
            color: #333;
        }
        .status {
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }
        .status.success { background-color: #d4edda; color: #155724; }
        .status.error { background-color: #f8d7da; color: #721c24; }
        .status.info { background-color: #d1ecf1; color: #0c5460; }
        button {
            background-color: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover { background-color: #0056b3; }
        .log {
            background-color: #f8f9fa;
            border: 1px solid #e9ecef;
            padding: 10px;
            border-radius: 4px;
            font-family: monospace;
            white-space: pre-wrap;
            max-height: 300px;
            overflow-y: auto;
        }
    </style>
</head>
<body>
    <h1>ğŸ§  æ€ç»´å¯¼å›¾AIåŠ©æ‰‹ - è°ƒè¯•é¡µé¢</h1>
    
    <div class="debug-section">
        <h3>ğŸ“‹ é¡µé¢ä¿¡æ¯</h3>
        <div id="pageInfo">
            <p><strong>æ ‡é¢˜:</strong> <span id="pageTitle">åŠ è½½ä¸­...</span></p>
            <p><strong>URL:</strong> <span id="pageUrl">åŠ è½½ä¸­...</span></p>
            <p><strong>å†…å®¹é•¿åº¦:</strong> <span id="contentLength">0</span> å­—ç¬¦</p>
        </div>
    </div>

    <div class="debug-section">
        <h3>ğŸ”§ æ’ä»¶çŠ¶æ€æ£€æµ‹</h3>
        <div id="extensionStatus" class="status info">æ£€æµ‹ä¸­...</div>
        <button onclick="checkExtension()">é‡æ–°æ£€æµ‹æ’ä»¶</button>
        <button onclick="testContentScript()">æµ‹è¯•å†…å®¹è„šæœ¬</button>
        <button onclick="testMessageCommunication()">æµ‹è¯•æ¶ˆæ¯é€šä¿¡</button>
    </div>

    <div class="debug-section">
        <h3>ğŸ“ å†…å®¹æå–æµ‹è¯•</h3>
        <button onclick="extractContent()">æå–é¡µé¢å†…å®¹</button>
        <button onclick="showDiagnostic()">æ˜¾ç¤ºè¯Šæ–­ä¿¡æ¯</button>
        <div id="contentPreview" class="log" style="display: none;"></div>
    </div>

    <div class="debug-section">
        <h3>ğŸ“Š è°ƒè¯•æ—¥å¿—</h3>
        <button onclick="clearLog()">æ¸…ç©ºæ—¥å¿—</button>
        <div id="debugLog" class="log">ç­‰å¾…æ“ä½œ...</div>
    </div>

    <script>
        let logContainer = document.getElementById('debugLog');
        
        function log(message, type = 'info') {
            const timestamp = new Date().toLocaleTimeString();
            const logEntry = `[${timestamp}] ${message}\n`;
            logContainer.textContent += logEntry;
            logContainer.scrollTop = logContainer.scrollHeight;
            console.log(message);
        }

        function clearLog() {
            logContainer.textContent = '';
        }

        function updatePageInfo() {
            document.getElementById('pageTitle').textContent = document.title;
            document.getElementById('pageUrl').textContent = window.location.href;
            document.getElementById('contentLength').textContent = document.body.textContent.length;
        }

        function checkExtension() {
            log('ğŸ” æ£€æµ‹æ’ä»¶çŠ¶æ€...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                log('âœ… Chromeæ‰©å±•APIå¯ç”¨');
                
                if (window.mindmapAI) {
                    log('âœ… å†…å®¹è„šæœ¬å·²åŠ è½½');
                    document.getElementById('extensionStatus').textContent = 'æ’ä»¶è¿è¡Œæ­£å¸¸';
                    document.getElementById('extensionStatus').className = 'status success';
                } else {
                    log('âš ï¸ å†…å®¹è„šæœ¬æœªåŠ è½½');
                    document.getElementById('extensionStatus').textContent = 'å†…å®¹è„šæœ¬æœªåŠ è½½';
                    document.getElementById('extensionStatus').className = 'status error';
                }
            } else {
                log('âŒ Chromeæ‰©å±•APIä¸å¯ç”¨');
                document.getElementById('extensionStatus').textContent = 'æ‰©å±•APIä¸å¯ç”¨';
                document.getElementById('extensionStatus').className = 'status error';
            }
        }

        function testContentScript() {
            log('ğŸ§ª æµ‹è¯•å†…å®¹è„šæœ¬...');
            
            if (window.mindmapAI) {
                log('âœ… å†…å®¹è„šæœ¬å¯¹è±¡å­˜åœ¨');
                log(`ğŸ“Š é¡µé¢å†…å®¹é•¿åº¦: ${window.mindmapAI.pageContent ? window.mindmapAI.pageContent.length : 0}`);
                log(`ğŸ“‹ é¡µé¢æ ‡é¢˜: ${window.mindmapAI.pageTitle || 'æœªè®¾ç½®'}`);
                log(`ğŸŒ é¡µé¢URL: ${window.mindmapAI.pageUrl || 'æœªè®¾ç½®'}`);
            } else {
                log('âŒ å†…å®¹è„šæœ¬å¯¹è±¡ä¸å­˜åœ¨');
            }
        }

        function testMessageCommunication() {
            log('ğŸ“¡ æµ‹è¯•æ¶ˆæ¯é€šä¿¡...');
            
            if (typeof chrome !== 'undefined' && chrome.runtime) {
                chrome.runtime.sendMessage({ action: 'test' }, (response) => {
                    if (chrome.runtime.lastError) {
                        log(`âŒ æ¶ˆæ¯é€šä¿¡å¤±è´¥: ${chrome.runtime.lastError.message}`);
                    } else {
                        log('âœ… æ¶ˆæ¯é€šä¿¡æ­£å¸¸');
                    }
                });
            } else {
                log('âŒ Chromeæ‰©å±•APIä¸å¯ç”¨');
            }
        }

        function extractContent() {
            log('ğŸ“ å¼€å§‹æå–é¡µé¢å†…å®¹...');
            
            if (window.mindmapAI) {
                try {
                    const content = window.mindmapAI.extractPageContent();
                    log(`âœ… å†…å®¹æå–æˆåŠŸï¼Œé•¿åº¦: ${content.length}`);
                    
                    const preview = document.getElementById('contentPreview');
                    preview.textContent = content.substring(0, 1000) + (content.length > 1000 ? '...' : '');
                    preview.style.display = 'block';
                } catch (error) {
                    log(`âŒ å†…å®¹æå–å¤±è´¥: ${error.message}`);
                }
            } else {
                log('âŒ å†…å®¹è„šæœ¬æœªåŠ è½½');
            }
        }

        function showDiagnostic() {
            log('ğŸ” è·å–è¯Šæ–­ä¿¡æ¯...');
            
            if (window.mindmapAI) {
                try {
                    const diagnostic = window.mindmapAI.getDiagnosticInfo();
                    log('ğŸ“Š è¯Šæ–­ä¿¡æ¯:');
                    log(`- çŠ¶æ€: ${diagnostic.status}`);
                    log(`- å†…å®¹é•¿åº¦: ${diagnostic.contentLength}`);
                    log(`- é¡µé¢æ ‡é¢˜: ${diagnostic.pageTitle}`);
                    log(`- ä¸­æ–‡å†…å®¹æ¯”ä¾‹: ${diagnostic.chinesePercentage}%`);
                    log(`- é—®é¢˜: ${diagnostic.issues.join(', ') || 'æ— '}`);
                } catch (error) {
                    log(`âŒ è·å–è¯Šæ–­ä¿¡æ¯å¤±è´¥: ${error.message}`);
                }
            } else {
                log('âŒ å†…å®¹è„šæœ¬æœªåŠ è½½');
            }
        }

        // é¡µé¢åŠ è½½å®Œæˆååˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            log('ğŸš€ è°ƒè¯•é¡µé¢å·²åŠ è½½');
            updatePageInfo();
            checkExtension();
        });

        // ç›‘å¬æ¥è‡ªæ‰©å±•çš„æ¶ˆæ¯
        if (typeof chrome !== 'undefined' && chrome.runtime) {
            chrome.runtime.onMessage.addListener((request, sender, sendResponse) => {
                log(`ğŸ“¨ æ”¶åˆ°æ¶ˆæ¯: ${JSON.stringify(request)}`);
                return true;
            });
        }
    </script>
</body>
</html>
